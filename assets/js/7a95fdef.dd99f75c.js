"use strict";(globalThis.webpackChunkrobodc_docs=globalThis.webpackChunkrobodc_docs||[]).push([[2426],{267:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"robo-2gen/comunicacao","title":"Comunica\xe7\xe3o - 2\xaa Gera\xe7\xe3o","description":"Comunica\xe7\xe3o Interna entre N\xf3s","source":"@site/docs/robo-2gen/comunicacao.md","sourceDirName":"robo-2gen","slug":"/robo-2gen/comunicacao","permalink":"/robodc-docs/robo-2gen/comunicacao","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/robo-2gen/comunicacao.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Arquitetura ROS 2","permalink":"/robodc-docs/robo-2gen/software/arquitetura-ros2"},"next":{"title":"Como Operar o Rob\xf4 de 1\xaa Gera\xe7\xe3o","permalink":"/robodc-docs/operacao/operacao-1gen"}}');var s=r(4848),a=r(8453);const o={sidebar_position:3},l="Comunica\xe7\xe3o - 2\xaa Gera\xe7\xe3o",c={},d=[{value:"Comunica\xe7\xe3o Interna entre N\xf3s",id:"comunica\xe7\xe3o-interna-entre-n\xf3s",level:2},{value:"DDS (Data Distribution Service)",id:"dds-data-distribution-service",level:3},{value:"Implementa\xe7\xf5es DDS Dispon\xedveis",id:"implementa\xe7\xf5es-dds-dispon\xedveis",level:4},{value:"Configurar RMW",id:"configurar-rmw",level:4},{value:"Intra-Process Communication",id:"intra-process-communication",level:3},{value:"QoS (Quality of Service)",id:"qos-quality-of-service",level:2},{value:"Pol\xedticas de QoS",id:"pol\xedticas-de-qos",level:3},{value:"Reliability",id:"reliability",level:4},{value:"Durability",id:"durability",level:4},{value:"History",id:"history",level:4},{value:"Exemplo de Configura\xe7\xe3o",id:"exemplo-de-configura\xe7\xe3o",level:3},{value:"Comunica\xe7\xe3o Multi-Rob\xf4",id:"comunica\xe7\xe3o-multi-rob\xf4",level:2},{value:"Usando ROS_DOMAIN_ID",id:"usando-ros_domain_id",level:3},{value:"Usando Namespaces",id:"usando-namespaces",level:3},{value:"Seguran\xe7a (SROS2)",id:"seguran\xe7a-sros2",level:2},{value:"Habilitar Seguran\xe7a",id:"habilitar-seguran\xe7a",level:3},{value:"Monitoramento de Comunica\xe7\xe3o",id:"monitoramento-de-comunica\xe7\xe3o",level:2},{value:"Ferramentas de An\xe1lise",id:"ferramentas-de-an\xe1lise",level:3},{value:"Diagn\xf3stico de Rede",id:"diagn\xf3stico-de-rede",level:3},{value:"Otimiza\xe7\xe3o de Performance",id:"otimiza\xe7\xe3o-de-performance",level:2},{value:"Best Practices",id:"best-practices",level:3},{value:"Lat\xeancia e Confiabilidade",id:"lat\xeancia-e-confiabilidade",level:2},{value:"Medi\xe7\xe3o de Lat\xeancia",id:"medi\xe7\xe3o-de-lat\xeancia",level:3},{value:"Garantir Confiabilidade",id:"garantir-confiabilidade",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"N\xf3s n\xe3o se Descobrem",id:"n\xf3s-n\xe3o-se-descobrem",level:3},{value:"Alta Lat\xeancia",id:"alta-lat\xeancia",level:3},{value:"Perda de Mensagens",id:"perda-de-mensagens",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"comunica\xe7\xe3o---2\xaa-gera\xe7\xe3o",children:"Comunica\xe7\xe3o - 2\xaa Gera\xe7\xe3o"})}),"\n",(0,s.jsx)(n.h2,{id:"comunica\xe7\xe3o-interna-entre-n\xf3s",children:"Comunica\xe7\xe3o Interna entre N\xf3s"}),"\n",(0,s.jsx)(n.h3,{id:"dds-data-distribution-service",children:"DDS (Data Distribution Service)"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 utiliza DDS como middleware de comunica\xe7\xe3o."}),"\n",(0,s.jsx)(n.h4,{id:"implementa\xe7\xf5es-dds-dispon\xedveis",children:"Implementa\xe7\xf5es DDS Dispon\xedveis"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fast DDS"})," (padr\xe3o)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cyclone DDS"})," (recomendado para melhor performance)"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"RTI Connext DDS"})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"configurar-rmw",children:"Configurar RMW"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp\n"})}),"\n",(0,s.jsx)(n.h3,{id:"intra-process-communication",children:"Intra-Process Communication"}),"\n",(0,s.jsx)(n.p,{children:"Comunica\xe7\xe3o otimizada dentro do mesmo processo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Habilitar intra-process\r\nnode = Node('my_node', enable_intra_process_comms=True)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Benef\xedcios:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Zero-copy quando poss\xedvel"}),"\n",(0,s.jsx)(n.li,{children:"Redu\xe7\xe3o significativa de lat\xeancia"}),"\n",(0,s.jsx)(n.li,{children:"Menor uso de CPU"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"qos-quality-of-service",children:"QoS (Quality of Service)"}),"\n",(0,s.jsx)(n.h3,{id:"pol\xedticas-de-qos",children:"Pol\xedticas de QoS"}),"\n",(0,s.jsx)(n.h4,{id:"reliability",children:"Reliability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RELIABLE"}),": Garante entrega (TCP-like)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BEST_EFFORT"}),": N\xe3o garante (UDP-like)"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"durability",children:"Durability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"VOLATILE"}),": Apenas para novos subscribers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TRANSIENT_LOCAL"}),": \xdaltimas N mensagens salvas"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"history",children:"History"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"KEEP_LAST"}),": Mant\xe9m \xfaltimas N mensagens"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"KEEP_ALL"}),": Mant\xe9m todas (at\xe9 limite de recursos)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"exemplo-de-configura\xe7\xe3o",children:"Exemplo de Configura\xe7\xe3o"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSReliabilityPolicy, QoSDurabilityPolicy\r\n\r\n# Para sensores (lat\xeancia cr\xedtica)\r\nsensor_qos = QoSProfile(\r\n    reliability=QoSReliabilityPolicy.BEST_EFFORT,\r\n    durability=QoSDurabilityPolicy.VOLATILE,\r\n    depth=10\r\n)\r\n\r\n# Para comandos (entrega garantida)\r\ncommand_qos = QoSProfile(\r\n    reliability=QoSReliabilityPolicy.RELIABLE,\r\n    durability=QoSDurabilityPolicy.TRANSIENT_LOCAL,\r\n    depth=1\r\n)\r\n\r\n# Criar subscription com QoS\r\nsubscription = node.create_subscription(\r\n    LaserScan,\r\n    '/scan',\r\n    callback,\r\n    sensor_qos\r\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"comunica\xe7\xe3o-multi-rob\xf4",children:"Comunica\xe7\xe3o Multi-Rob\xf4"}),"\n",(0,s.jsx)(n.h3,{id:"usando-ros_domain_id",children:"Usando ROS_DOMAIN_ID"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Rob\xf4 1\r\nexport ROS_DOMAIN_ID=1\r\nros2 launch robodc_bringup robot.launch.py\r\n\r\n# Rob\xf4 2\r\nexport ROS_DOMAIN_ID=2\r\nros2 launch robodc_bringup robot.launch.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usando-namespaces",children:"Usando Namespaces"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 launch robodc_bringup robot.launch.py namespace:=/robot1\r\nros2 launch robodc_bringup robot.launch.py namespace:=/robot2\n"})}),"\n",(0,s.jsx)(n.h2,{id:"seguran\xe7a-sros2",children:"Seguran\xe7a (SROS2)"}),"\n",(0,s.jsx)(n.h3,{id:"habilitar-seguran\xe7a",children:"Habilitar Seguran\xe7a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Criar keystore\r\nros2 security create_keystore demo_keys\r\n\r\n# Criar chaves para n\xf3\r\nros2 security create_key demo_keys /my_node\r\n\r\n# Executar com seguran\xe7a\r\nexport ROS_SECURITY_KEYSTORE=~/demo_keys\r\nexport ROS_SECURITY_ENABLE=true\r\nros2 run pkg node\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoramento-de-comunica\xe7\xe3o",children:"Monitoramento de Comunica\xe7\xe3o"}),"\n",(0,s.jsx)(n.h3,{id:"ferramentas-de-an\xe1lise",children:"Ferramentas de An\xe1lise"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Ver bandwidth de t\xf3pico\r\nros2 topic bw /scan\r\n\r\n# Ver frequ\xeancia\r\nros2 topic hz /scan\r\n\r\n# Ver lat\xeancia (com echo)\r\nros2 topic echo /scan --field header.stamp\r\n\r\n# Informa\xe7\xf5es detalhadas\r\nros2 topic info /scan -v\n"})}),"\n",(0,s.jsx)(n.h3,{id:"diagn\xf3stico-de-rede",children:"Diagn\xf3stico de Rede"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Doctor para diagn\xf3stico geral\r\nros2 doctor\r\n\r\n# Verificar peers\r\nros2 daemon status\r\n\r\n# Ver n\xf3s descobertos\r\nros2 node list\n"})}),"\n",(0,s.jsx)(n.h2,{id:"otimiza\xe7\xe3o-de-performance",children:"Otimiza\xe7\xe3o de Performance"}),"\n",(0,s.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usar QoS apropriado"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"BEST_EFFORT para sensores"}),"\n",(0,s.jsx)(n.li,{children:"RELIABLE para comandos cr\xedticos"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Intra-process quando poss\xedvel"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Composable nodes"}),"\n",(0,s.jsx)(n.li,{children:"Component containers"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Limitar taxa de publica\xe7\xe3o"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Publicar a 10 Hz em vez de loop infinito\r\ntimer = node.create_timer(0.1, timer_callback)\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usar Cyclone DDS"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configurar DDS para rede"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- cyclonedds.xml --\x3e\r\n<CycloneDDS>\r\n  <Domain>\r\n    <General>\r\n      <NetworkInterfaceAddress>eth0</NetworkInterfaceAddress>\r\n    </General>\r\n  </Domain>\r\n</CycloneDDS>\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"lat\xeancia-e-confiabilidade",children:"Lat\xeancia e Confiabilidade"}),"\n",(0,s.jsx)(n.h3,{id:"medi\xe7\xe3o-de-lat\xeancia",children:"Medi\xe7\xe3o de Lat\xeancia"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Header\r\n\r\nclass LatencyNode(Node):\r\n    def __init__(self):\r\n        super().__init__('latency_node')\r\n        self.subscription = self.create_subscription(\r\n            Header,\r\n            '/test_topic',\r\n            self.callback,\r\n            10\r\n        )\r\n    \r\n    def callback(self, msg):\r\n        now = self.get_clock().now()\r\n        sent_time = rclpy.time.Time.from_msg(msg.stamp)\r\n        latency = (now - sent_time).nanoseconds / 1e6  # ms\r\n        self.get_logger().info(f'Latency: {latency:.2f} ms')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"garantir-confiabilidade",children:"Garantir Confiabilidade"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Usar RELIABLE QoS para mensagens cr\xedticas"}),"\n",(0,s.jsx)(n.li,{children:"Implementar heartbeats/watchdogs"}),"\n",(0,s.jsx)(n.li,{children:"Logging adequado"}),"\n",(0,s.jsx)(n.li,{children:"Tratamento de exce\xe7\xf5es"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"n\xf3s-n\xe3o-se-descobrem",children:"N\xf3s n\xe3o se Descobrem"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Causas comuns"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ROS_DOMAIN_ID diferente"}),"\n",(0,s.jsx)(n.li,{children:"Firewall bloqueando multicast"}),"\n",(0,s.jsx)(n.li,{children:"Interface de rede errada"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solu\xe7\xf5es"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Verificar domain\r\necho $ROS_DOMAIN_ID\r\n\r\n# Verificar daemon\r\nros2 daemon status\r\nros2 daemon stop\r\nros2 daemon start\r\n\r\n# Testar comunica\xe7\xe3o\r\nros2 run demo_nodes_cpp talker  # Terminal 1\r\nros2 run demo_nodes_cpp listener  # Terminal 2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alta-lat\xeancia",children:"Alta Lat\xeancia"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solu\xe7\xf5es"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Mudar para Cyclone DDS"}),"\n",(0,s.jsx)(n.li,{children:"Usar intra-process communication"}),"\n",(0,s.jsx)(n.li,{children:"Ajustar QoS (BEST_EFFORT para sensores)"}),"\n",(0,s.jsx)(n.li,{children:"Verificar sobrecarga de CPU"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"perda-de-mensagens",children:"Perda de Mensagens"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solu\xe7\xf5es"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Aumentar depth do QoS"}),"\n",(0,s.jsx)(n.li,{children:"Usar RELIABLE em vez de BEST_EFFORT"}),"\n",(0,s.jsx)(n.li,{children:"Verificar bandwidth da rede"}),"\n",(0,s.jsx)(n.li,{children:"Reduzir taxa de publica\xe7\xe3o"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);